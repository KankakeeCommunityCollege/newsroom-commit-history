function GetIEVersion() {
  var sAgent = window.navigator.userAgent;
  var Idx = sAgent.indexOf('MSIE');

  // If IE, return version number.
  if (Idx > 0) {
    return parseInt(sAgent.substring(Idx+ 5, sAgent.indexOf('.', Idx)));
  }
  // If IE 11 then look for Updated user agent string.
  else if (!!navigator.userAgent.match(/Trident\/7\./)) {
    return 11;
  }
  else {
    // console.log('Not IE. Im proud of you for not using IE!');
    return 0; //It is not IE
  }
}

if (GetIEVersion() > 10) {
  // console.log('CONGRATULATIONS! Your using the worst internet browser possible!');
  // console.log('This is IE ' + GetIEVersion());
  $('[id*="jsTeaseLink"]').addClass('ie-only__no-flex');
  $('.latest-news-widget__latest__tease__img-mod--default').addClass('ie-only__float-right');
  $('.latest-news-widget__latest__tease__hgroup').addClass('ie-only__hgroup');
}

//var windowSize = $(window).innerWidth();
//console.log(windowSize);

// SETS THE CURRENT DATE IN THE "LATEST-NEWS-WIDGET"
$(document).ready(function () {
  var dt = new Date();
  var time = dt.getMonth()+1 + '.' + dt.getDate();
  $('#todaysDate').html(time);
});

// CUSTOM JS FOR LATEST-NEWS-WIDGET
$(document).ready(function () {
  var img1 =  $('#latestNewsImage1').attr('src');
  var img2 =  $('#latestNewsImage2').attr('src');
  var img3 =  $('#latestNewsImage3').attr('src');
  var img4 =  $('#latestNewsImage4').attr('src');

  var link1 =  $('#jsNewsLink1').attr('href');
  var link2 =  $('#jsNewsLink2').attr('href');
  var link3 =  $('#jsNewsLink3').attr('href');
  var link4 =  $('#jsNewsLink4').attr('href');

  $('.js-hp-feature').addClass('topper-trans-in');
  $('.js-play-icon').addClass('topper-trans-in');

  function jsNewsLinkFunction() {
    var jsNewsLinks = [ $('#jsNewsLink1'), $('#jsNewsLink2'), $('#jsNewsLink3'), $('#jsNewsLink4') ];
    for (var i = 0; i < jsNewsLinks.length; i++) {
      jsNewsLinks[i].removeClass('topper-trans-in');
      jsNewsLinks[i].addClass('topper-trans-out');
    }
  }
  function jsPlayIcon() {
    var jsPlayButtons = [ $('#playIcon1'), $('#playIcon2'), $('#playIcon3'), $('#playIcon4'), ];
    for (var i = 0; i < jsPlayButtons.length; i++) {
      jsPlayButtons[i].removeClass('topper-trans-in');
      jsPlayButtons[i].addClass('topper-trans-out');
    }
  }
  $('#jsTeaseLink1').mouseenter(function() {
  // When mouse enters jsTeaseLink1 do this:
  //  $('.js-hp-feature').removeClass('topper-trans-in');
  //  $('.js-hp-feature').addClass('topper-trans-out');

    jsNewsLinkFunction();
    jsPlayIcon();

    $('#jsNewsLink1').removeClass('topper-trans-out');
    $('#jsNewsLink1').addClass('topper-trans-in');

    $('#playIcon1').removeClass('play-zoom-out').removeClass('topper-trans-out');
    $('#playIcon1').addClass('topper-trans-in');

    // set jsTeaseLink1 aria-hidden attribute's value to "false":
    $('#jsTeaseLink1').attr('aria-hidden', 'false');
    $('#jsNewsLink1').attr('aria-hidden', 'false');

    $('#jsTeaseList').find('.tease-is-active').removeClass('tease-is-active');
    $('#jsTeaseLink1').addClass('tease-is-active');

    // set all other aira-hidden atrribute values to "true":
    $('#jsTeaseLink2').attr('aria-hidden', 'true');
    $('#jsTeaseLink3').attr('aria-hidden', 'true');
    $('#jsTeaseLink4').attr('aria-hidden', 'true');
    $('#jsNewsLink2').attr('aria-hidden', 'true');
    $('#jsNewsLink3').attr('aria-hidden', 'true');
    $('#jsNewsLink4').attr('aria-hidden', 'true');

    // set js-hp-feature--img-mod style to background image:
    $('.js-hp-feature--img-mod').css('background-image', 'url("' + img1 + '")');
    $('.js-hp-topper-img').attr('src', img1);
    $('.js-hp-feature').attr('href', link1);

    $('.latest-news-widget__feature-mod--inner').css({ transform: 'translate3d(0%, 0, 0)' });
  });

  $('#jsTeaseLink2').mouseenter(function() {
  // When mouse enters jsTeaseLink1 do this:
  //  $('.js-hp-feature').removeClass('topper-trans-in');
  //  $('.js-hp-feature').addClass('topper-trans-out');

    jsNewsLinkFunction();
    jsPlayIcon();

    $('#jsNewsLink2').removeClass('topper-trans-out');
    $('#jsNewsLink2').addClass('topper-trans-in');

    $('#playIcon2').removeClass('play-zoom-out').removeClass('topper-trans-out');
    $('#playIcon2').addClass('topper-trans-in');

    // set jsTeaseLink1 aria-hidden attribute's value to "false":
    $('#jsTeaseLink2').attr('aria-hidden', 'false');
    $('#jsNewsLink2').attr('aria-hidden', 'false');

    $('#jsTeaseList').find('.tease-is-active').removeClass('tease-is-active');
    $('#jsTeaseLink2').addClass('tease-is-active');

    // set all other aira-hidden atrribute values to "true":
    $('#jsTeaseLink1').attr('aria-hidden', 'true');
    $('#jsTeaseLink3').attr('aria-hidden', 'true');
    $('#jsTeaseLink4').attr('aria-hidden', 'true');
    $('#jsNewsLink1').attr('aria-hidden', 'true');
    $('#jsNewsLink3').attr('aria-hidden', 'true');
    $('#jsNewsLink4').attr('aria-hidden', 'true');

    // set js-hp-feature--img-mod style to background image:
    $('.js-hp-feature--img-mod').css('background-image', 'url("' + img2 + '")');
    $('.js-hp-topper-img').attr('src', img2);
    $('.js-hp-feature').attr('href', link2);

    $('.latest-news-widget__feature-mod--inner').css({ transform: 'translate3d(-25%, 0, 0)' });
  });

  $('#jsTeaseLink3').mouseenter(function() {
  // When mouse enters jsTeaseLink1 do this:
  //  $('.js-hp-feature').removeClass('topper-trans-in');
  //  $('.js-hp-feature').addClass('topper-trans-out');

    jsNewsLinkFunction();
    jsPlayIcon();

    $('#jsNewsLink3').removeClass('topper-trans-out');
    $('#jsNewsLink3').addClass('topper-trans-in');

    $('#playIcon3').removeClass('play-zoom-out').removeClass('topper-trans-out');
    $('#playIcon3').addClass('topper-trans-in');

    // set jsTeaseLink1 aria-hidden attribute's value to "false":
    $('#jsTeaseLink3').attr('aria-hidden', 'false');
    $('#jsNewsLink3').attr('aria-hidden', 'false');

    $('#jsTeaseList').find('.tease-is-active').removeClass('tease-is-active');
    $('#jsTeaseLink3').addClass('tease-is-active');

    // set all other aira-hidden atrribute values to "true":
    $('#jsTeaseLink1').attr('aria-hidden', 'true');
    $('#jsTeaseLink2').attr('aria-hidden', 'true');
    $('#jsTeaseLink4').attr('aria-hidden', 'true');
    $('#jsNewsLink1').attr('aria-hidden', 'true');
    $('#jsNewsLink2').attr('aria-hidden', 'true');
    $('#jsNewsLink4').attr('aria-hidden', 'true');

    // set js-hp-feature--img-mod style to background image:
    $('.js-hp-feature--img-mod').css('background-image', 'url("' + img3 + '")');
    $('.js-hp-topper-img').attr('src', img3);
    $('.js-hp-feature').attr('href', link3);

    $('.latest-news-widget__feature-mod--inner').css({ transform: 'translate3d(-50%, 0, 0)' });
  });

  $('#jsTeaseLink4').mouseenter(function() {
  // When mouse enters jsTeaseLink1 do this:
  //  $('.js-hp-feature').removeClass('topper-trans-in');
  //  $('.js-hp-feature').addClass('topper-trans-out');

    jsNewsLinkFunction();
    jsPlayIcon();

    $('#jsNewsLink4').removeClass('topper-trans-out');
    $('#jsNewsLink4').addClass('topper-trans-in');

    $('#playIcon4').removeClass('play-zoom-out').removeClass('topper-trans-out');
    $('#playIcon4').addClass('topper-trans-in');

    // set jsTeaseLink1 aria-hidden attribute's value to "false":
    $('#jsTeaseLink4').attr('aria-hidden', 'false');
    $('#jsNewsLink4').attr('aria-hidden', 'false');

    $('#jsTeaseList').find('.tease-is-active').removeClass('tease-is-active');
    $('#jsTeaseLink4').addClass('tease-is-active');

    // set all other aira-hidden atrribute values to "true":
    $('#jsTeaseLink1').attr('aria-hidden', 'true');
    $('#jsTeaseLink2').attr('aria-hidden', 'true');
    $('#jsTeaseLink3').attr('aria-hidden', 'true');
    $('#jsNewsLink1').attr('aria-hidden', 'true');
    $('#jsNewsLink2').attr('aria-hidden', 'true');
    $('#jsNewsLink3').attr('aria-hidden', 'true');

    // set js-hp-feature--img-mod style to background image:
    $('.js-hp-feature--img-mod').css('background-image', 'url("' + img4 + '")');
    $('.js-hp-topper-img').attr('src', img4);
    $('.js-hp-feature').attr('href', link4);

    $('.latest-news-widget__feature-mod--inner').css({ transform: 'translate3d(-75%, 0, 0)' });
  });

  $('#featureHover').mouseenter(function () {
    $('.js-play-icon').removeClass('play-zoom-out').addClass('play-zoom-in');
  });
  $('#featureHover').mouseleave(function () {
    $('.js-play-icon').removeClass('play-zoom-in').addClass('play-zoom-out');
  });

});

// Highlights the current page in local navigation bar
$(document).ready(function () {
  var currentUrl = window.location.href;
  var noProto = currentUrl.replace(/(^\w+:|^)\/\//, '');
  $('#navbarSupportedContent').find('.active').removeClass('active');
  if (noProto == 'news.kcc.edu/') {
    $('#home').addClass('active');
  } else if (currentUrl.indexOf('/events/') > -1) {
    $('#events').addClass('active');
  } else if (currentUrl.indexOf('/news/') > -1) {
    $('#news').addClass('active');
  } else if (currentUrl.indexOf('/videos/') > -1) {
    $('#videos').addClass('active');
  }
});

// Shrink the local navbar when you scroll down
// (navbar scroll effects)
var navbarCollapse = function() {
  if ($('#mainNav').offset().top > 100) {
    $('#mainNav').addClass('navbar-shrink');
  } else {
    $('#mainNav').removeClass('navbar-shrink');
  }
};
// Collapse now if page is not at top
navbarCollapse();
// Collapse the navbar when page is scrolled
$(window).scroll(navbarCollapse);

// Play a YouTube embed when you click it's modal link that opens it
$(document).ready(function(){
  function autoPlayModal(){
    var trigger = $('body').find('[data-toggle="modal"]');
    trigger.click(function() {
      var theModal = $(this).data( 'target' );
      var theVid = $(theModal).find('iframe').attr('data-theVideo');
      var playVid = theVid + '?rel=0&autoplay=1';
      //var theVid = $(theModal).find('iframe').data( 'theVideo' );
      //var theSource = $(theModal).find('iframe').attr('src');
      //var autoSource = $(theModal).find('iframe').attr('src') + '?rel=0&autoplay=1';
      $(theModal).find('[id*="iframe"]').attr('allow', 'autoplay; encrypted-media');
      $(theModal).find('[id*="iframe"]').attr('src', playVid);
      $(theModal).on('hidden.bs.modal', function () {
        $(theModal).find('[id*="iframe"]').attr('allow', '');
        $(theModal).find('[id*="iframe"]').attr('src', '');
      });
    });
  }
//  function stopModalNow() {
//    var fullPageButton = $('body').find('[id*="fullPageVideo"]');
//    fullPageButton.click(function() {
//      console.log('clicked!');
//      var theIframeTarget = $(this).data( 'iframetarget' );
//      var theIframeSrc = $(iframeTarget).attr('src');
//      var stopIframeSrc = theIframeSrc.replace('?rel=0&autoplay=1', '');
//      $(theIframeTarget).attr('src', stopIframeSrc);
//      console.log('play removed');
//    });
//  }
//  stopModalNow();

  function stopVidNow() {
    var stopTrigger = $('body').find('[id*="fullPageVideo"]');
    stopTrigger.click(function() {
      var theIframe = $(this).data( 'iframetarget' );
      $(theIframe).attr('src', '');
    });
  }
  autoPlayModal();
  stopVidNow();
});

//$(document).ready(function() {
//  $('iframe').one('load', function() {
//    console.log('one success');
//    $('iframe').attr('allow', '');
//    console.log('disallow');
//  });
//});

//$(document).one('load', function() {
//  var i;
//  for (i = 1; i < 5; i++) {
//    var iframeId = '#iframe' + i;
//    var iframeWithId = $(iframeId);
//    var idSrc = iframeWithId.attr('src');
//    if (idSrc.indexOf('?rel=0&autoplay=1') != -1) {
//      var stopSrc =  idSrc.replace('?rel=0&autoplay=1', '');
//      iframeWithId.attr('src', stopSrc);
//    }
//  }
//});

//$(document).one('ready', function() {
//  console.log('One function triggered!');
//  var iframe1 = $('#iframe1');
//  var iframe2 = $('#iframe2');
//  var iframe1 = $('#iframe3');
//  var iframe1 = $('#iframe4');
//  var src1 = iframe1.attr('src');
//  var src2 = iframe2.attr('src');
//  var src3 = iframe3.attr('src');
//  var src4 = iframe4.attr('src');
//  function iframePlayCheck() {
//    console.log('iframePlayCheck function initiated!');
//    if (src1.indexOf('?rel=0&autoplay=1') != -1) {
//      console.log('Modal 1 Playing!');
//      var stop1 = src1.replace('?rel=0&autoplay=1', '');
//      iframe1.attr('src', stop1);
//    } else if (src2.indexOf('?rel=0&autoplay=1') != -1) {
//      console.log('Modal 2 Playing!');
//      var stop2 = src2.replace('?rel=0&autoplay=1', '');
//      iframe2.attr('src', stop2);
//    } else if (src3.indexOf('?rel=0&autoplay=1') != -1) {
//      console.log('Modal 3 Playing!');
//      var stop3 = src3.replace('?rel=0&autoplay=1', '');
//      iframe3.attr('src', stop3);
//    } else if (src4.indexOf('?rel=0&autoplay=1') != -1) {
//      console.log('Modal 2 Playing!');
//      var stop4 = src4.replace('?rel=0&autoplay=1', '');
//      iframe4.attr('src', stop4);
//    }
//  }
//  iframePlayCheck();
//});

// Custom JS to toggle the search form on mobile devices
var imgsrc = $('#searchImg').attr('src');
//function toggler() {
//  if (imgsrc.indexOf('assets/img/search.svg') != -1) {
//    console.log('true');
//    $('#searchImg').attr('src', 'assets/img/x.svg');
//  } else {
//    $('#searchImg').attr('src', 'assets/img/search.svg');
//    console.log('false');
//  }
//}
$('#searchIcon').click(function () {
  function searchCheck() {
    var imgUrl = $('#searchImg').css('background-image');
    if ( imgUrl.indexOf('assets/img/search.svg') != -1 ) {
//      $('#searchImg').css('background-image', '../../../../x.svg');
//      console.log('search');
      $('#searchImg').css('background-image', 'url("http://news.kcc.edu/assets/img/x.svg")');
    } else {
      $('#searchImg').css('background-image', 'url("http://news.kcc.edu/assets/img/search.svg")');
    }
  }
  searchCheck();
  $('#searchCollapse').toggleClass('global-nav__search-collapse--visible');
//  $('#searchImg').css('background-image', 'url('')')
//  toggler();
  $('#mainNav').toggleClass('local-nav--search-toggle');
  $('#globalNav').toggleClass('global-nav--search-toggle');
});


$('document').ready(function () {
  // Inject custom text into Google Custom Search input-field's placeholder text.
  function placeholderText() {
    // Write the "placeholder" attribute . . .
    $('input.gsc-input').attr('placeholder', 'Search KCC...');
  }
  // HOWEVER!! Don't do it for 3,000 milliseconds after document.ready has fired (give Google Custom Search's script time finish). . .
  // otherwise the Google's script overwrites any JS injected customization like this.
  window.setTimeout(placeholderText, 3000);
});

// Fix for Bootstrap 4's issues displaying modals with fixed navigation
$(document).ready(function(){
  var $outer = $('<div>').css({visibility: 'hidden', width: 100, overflow: 'scroll'}).appendTo('body'),
    widthWithScroll = $('<div>').css({width: '100%'}).appendTo($outer).outerWidth();
  $outer.remove();
  var scrollBarWidth = 100 - widthWithScroll;

  $('.modal').on('shown.bs.modal', function () {
    $('body').css('padding-right', '0');
    $('#mainNav').css('padding-right', '1rem');
    $('#globalNav').css('padding-right', '1rem');
  });


//  $('body').find('[data-toggle="modal"]').on('click', function () {
//    if ($('body').hasClass('modal-open') != true) {
//      console.log("modal open");
//      $('body').css('margin-right', '-' + scrollBarWidth + 'px');
//    } else {
//      $('body').css('margin-right', '0');
//      console.log("modal closed")
//    }
//  });
//  $('body').find('[data-dismiss="modal"]').on('click', function () {
//    if ($('body').hasClass('modal-open') != true) {
//      console.log("modal open");
//      $('body').css('margin-right', '-' + scrollBarWidth + 'px');
//    } else {
//      $('body').css('margin-right', '0');
//      console.log("modal closed")
//    }
//  });
//  console.log(scrollBarWidth);
});

function checkForPound() {
  if (window.location.href.indexOf("#contact") > -1) {
      setTimeout(function () {
        var scrollBottom = $(document).height();
        //console.log(scrollBottom);
        window.scroll('0', scrollBottom);
      }, 1000);
  }
}
checkForPound();

$(document).ready(function() { // Wait for document to load
  // Define variable to find  all our span elements with class  ".latest-news-widget__latest__tease__number"
  var spanNumber = $('.latest-news-widget__latest__tease__number');
  // Run a forloop on all the spans w/ ".latest-news-widget__latest__tease__number" class in the page.
  for (var i = 0; i < spanNumber.length; i++) {
    // Write the forloop's index (i) + 1 into it's innerHTML to show as the count number:
    spanNumber[i].innerHTML = i + 1;
  }
});
